<body>
  <!-- React/JSX -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.1/JSXTransformer.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.1/react-with-addons.js"></script>

  <!-- Bootstrap -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">-->
  <link rel="stylesheet" href="bootstrap.min.css">
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">-->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

  <style>
  .jsonResponse {
    font-family: Courier New, Fixed-width;
    width: 80%;
  }
  .doc {
    border-collapse: collapse;
    border-width: 1px 1px 1px 1px;
    border-color: #aaaaaa;
    border-style: solid;
    padding: 5px 5px 5px 5px;
  }
  </style>

  <!-- Where React will render everything -->
  <div id="react-container"></div>

  <!-- React source for page -->
  <script type="text/jsx">

  var UrlWithParameters = React.createClass({

    getInitialState: function () {
      return {
        responseData: null,
      };
    },

    render: function () {
      var base = window.location.origin;
      var keys = Object.keys(this.props.paramValues || {});
      var terms = [];
      var errors = [];
      for (var i = 0; i < keys.length; i++) {
        var key = keys[i];
        var val = this.props.paramValues[key];
        var term = encodeURIComponent(key) + '=' + encodeURIComponent(val);
        terms.push(term);
        if (this.props.rows[i].requiredOptional == 'required') {
          if (!val) {
            errors.push("Missing required parameter: '" + key + "'");
          }
        }
      }
      var url = base + '/' + this.props.apiMethod + '?' + (terms.join('&'));

      return (
        <div>
          <code>{url}</code>
          <p><input type="submit" value=" Try it " onClick={(function () {
            console.log("Try it: " + url);
            this.setState({responseData: null});
            $.ajax({
              type: 'GET',
              dataType: 'json',
              url: url,
              success: (function (data) {
                  console.log("responseData=", data);
                  this.setState({responseData: data});
                }).bind(this),
              error: (function (err) {
                  console.error("GET failed", err);
                  this.setState({responseData: JSON.parse(err.responseText)});
                }).bind(this),
              });
          }).bind(this)} className="tryItButton" /></p>
          <JSONResponse response={this.state.responseData} />
        </div>
      );
    }
  });

  var JSONResponse = React.createClass({
    render: function () {
      return (
        <p>
          {this.props.response && (<textarea className="jsonResponse" value={JSON.stringify(this.props.response)} />) || null}
        </p>
      );
    },
  });

  var ParameterTableWithUrl = React.createClass({
    render: function () {
      return (
        <div>
          <table>
            <thead>
              <tr>
                <th>Parameter</th>
                <th>Description</th>
                <th>req/opt</th>
                <th>Default</th>
                <th>Try It!</th>
              </tr>
            </thead>
            <tbody>
              {this._renderRows(this.props.rows)}
            </tbody>
          </table>
          <p>
            <UrlWithParameters rows={this.props.rows} paramValues={this.state} apiMethod={this.props.apiMethod} />
          </p>
        </div>
      );
    },

    _renderRows: function (rows) {
      return rows.map(this._renderBodyRow);
    },

    _renderBodyRow: function (row) {
      var parameter = row.parameter;
      var description = row.description;
      var requiredOptional = row.requiredOptional;
      var defaultValue = row.defaultValue;
      return (
        <tr key={row.parameter}>
          <td key="parameter" className="parameter doc">{row.parameter}</td>
          <td key="description" className="description doc">{row.description}</td>
          <td key="requiredOptional" className="requiredOptional doc">{row.requiredOptional}</td>
          <td key="defaultValue" className="defaultValue doc">{row.defaultValue}</td>
          <td key="tryIt" className="tryIt doc"><input onChange={(function (event) {
            var stateChange = {};
            stateChange[row.parameter] = event.target.value;
            this.setState(stateChange);
          }).bind(this)} type="text" name={row.parameter} defaultValue={row.defaultValue || ''} /></td>
        </tr>
      );
    },

  });

  var developerEmailRow = {
    parameter: 'developerEmail',
    description: 'Your e-mail address so we can contact you',
    requiredOptional: 'required',
  };
  var userMobileNumberRow = {
    parameter: 'userMobileNumber',
    description: "The user's mobile number",
    requiredOptional: 'required',
  };

  var Header = React.createClass({
    render: function () {
      return (
        <div>
          <h1>Digitimate</h1>
          <h3>The legitimately easiest way to verify user{"'"}s mobile numbers via SMS in two easy steps</h3>
        </div>
      );
    },
  });

  var Body = React.createClass({
    render: function () {
      return (
        <div>
          <h2>No signup required. Free. Open source.</h2>
          <p>You don{"'"}t need to create an account or signup anywhere to get started; just include your e-mail
            in the <code>developerEmail</code> parameter on your requests.</p>
          <p>You can verify your first 30,000 users using Digitimate for free. After that, we{"'"}ll work with you
            to charge something that covers our costs.</p>
          <p>Or if you prefer, you can run the service yourself. The code is open source and available <a href="https://github.com/digitimate/digitimate">on GitHub</a>.</p>
          <h2>Step 1: Send an SMS to a user using a <code>sendCode</code> request</h2>
          <p>When a user enters their mobile number into your app, just send an HTTP request to Digitimate that looks
            like this</p>
          <ParameterTableWithUrl apiMethod="sendCode" rows={[
            developerEmailRow,
            userMobileNumberRow,
            {
              parameter: 'message',
              description: 'A custom message format for the SMS sent to the user',
              requiredOptional: 'optional',
              defaultValue: 'Code: ',
            },
            {
              parameter: 'numberOfDigits',
              description: 'The number of digits in the code to send',
              requiredOptional: 'optional',
              defaultValue: '6',
            },
          ]}/>

          <h2>Step 2: Check that the user has entered the correct code with a <code>checkCode</code> request</h2>
          <p>When the user has gotten the SMS and entered the code, send an HTTP request to Digitimate that looks like this</p>
          <ParameterTableWithUrl apiMethod="checkCode" rows={[
            developerEmailRow,
            userMobileNumberRow,
            {
              parameter: 'code',
              description: 'The code the user entered to check against the one we sent to the user via SMS',
              requiredOptional: 'required',
            }
          ]}/>
        </div>
      );
    },
  });

  var Page = React.createClass({
    render: function () {
      return (
        <div>
          <Header />
          <Body />
        </div>
      );
    },
  });
  React.render(<Page />, document.getElementById('react-container'));
  </script>
</body>
